@using SWSA.MvcPortal.Commons.Helpers
@using SWSA.MvcPortal.Models.Companies
@model CompanyEditPageVM
@{
    ViewData["Title"] = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var groupedMsicCodes = Model.MsicCodes
       .GroupBy(m => m.CategoryReferences)
       .ToList();

    var cp = Model.Company;

    var companyStatus = SelectHelper.GetCompanyStatus(cp.Status);
    var ownerPosition = SelectHelper.GetOwnerPositionTypes(null);
    var ownershipTypes = SelectHelper.GetOwnershipTypes(null);
    var staffPosition = SelectHelper.GetStaffPositionTypes(null);
    var cpMsicCodeIds = cp.MsicCodes.Select(m => m.Id).ToList();

    <input type="hidden" id="companyId" value="@cp.Id" />
}

<link rel="stylesheet" href="~/lib/flatpickr/flatpickr.min.css">
<link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/style.css" rel="stylesheet" />
<!-- Select2 -->

<link rel="stylesheet" href="~/admin-lte/plugins/select2/css/select2.min.css">
<link rel="stylesheet" href="~/admin-lte/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">

<!-- DataTables -->
<link rel="stylesheet" href="~/admin-lte/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" href="~/admin-lte/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
<link rel="stylesheet" href="~/admin-lte/plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
<link href="~/admin-lte/plugins/datatables-select/css/select.bootstrap4.min.css" rel="stylesheet" />

<h3>Edit @cp.Name Profile</h3>

<div class="row">
    <div class="col-md-12">
        <form id="companyForm">
            <!-- jquery validation -->
            <div class="card card-primary">
                <div class="card-header">
                    <h3 class="card-title">Company Info</h3>

                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-minus"></i>
                        </button>
                    </div>
                </div>

                <!-- /.card-header -->
                <!-- form start -->
                <div class="card-body row">

                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="companyName">Company Name*</label>
                            <input id="companyName" name="companyName" value="@cp.Name" class="form-control " placeholder="xxx sdn.bhd." />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="regisNumber">Registration Number</label>
                            <input id="regisNumber" name="regisNumber" value="@cp.RegistrationNumber" class="form-control " placeholder="2025041153513" />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="eNumber">Employer Number (E Number)</label>
                            <input id="eNumber" name="eNumber" value="@cp.EmployerNumber" class="form-control" placeholder="12-3456789" />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="tinNumber">Tax Identification Number (TIN)</label>
                            <input id="tinNumber" name="tinNumber" value="@cp.TaxIdentificationNumber" class="form-control " placeholder="E 16164351 / C 16513513" />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="incorpDate">Incorporation Date</label>
                            <div class="input-group">
                                <input type="text" id="incorpDate" value="@cp.IncorporationDate" name="incorpDate" class="form-control" placeholder="Select date" />
                                <div class="input-group-append">
                                    <span class="input-group-text">
                                        <i class="fa fa-calendar"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="yearEndMonth">Year End Month</label>
                            <div class="input-group">
                                <input type="text" id="yearEndMonth" value="@cp.GetYearEndMonthLabel()" name="yearEndMonth" class="form-control" placeholder="Select month" />
                                <div class="input-group-append">
                                    <span class="input-group-text">
                                        <i class="fa fa-calendar"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="companyType">Company Type</label>
                            <select id="companyType" name="companyType" class="form-control select2">
                                <option selected="true" value="">Please select</option>
                                @foreach (var type in Model.CompanyType)
                                {
                                    if (type.Id == cp.CompanyTypeId)
                                    {
                                        <option selected="true" value="@type.Id">@type.Name</option>
                                    }
                                    else
                                    {
                                        <option value="@type.Id">@type.Name</option>
                                    }
                                }

                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="companyStatus">Company Status</label>
                            <select asp-items="@companyStatus" id="companyStatus" name="companyStatus" class="form-control select2">  </select>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="msicCodesIds">Malaysia Standard Industrial Classification (MSIC) </label>
                            <select id="msicCodesIds" name="msicCodesIds" class="form-control select2" multiple="multiple" style="max-width:95%">
                                @foreach (var group in groupedMsicCodes)
                                {
                                    <optgroup label="@group.Key">
                                        @foreach (var msicCode in group)
                                        {
                                            if (cpMsicCodeIds.Contains(msicCode.Id))
                                            {
                                                <option selected value="@msicCode.Id">@msicCode.Code (@msicCode.Description)</option>
                                            }
                                            else
                                            {
                                                <option value="@msicCode.Id">@msicCode.Code (@msicCode.Description)</option>
                                            }
                                        }
                                    </optgroup>
                                })
                            </select>
                        </div>
                    </div>

                </div>

            </div>
        </form>
        <!-- /.card -->
    </div>

    <div class="col-md-12">
        <!-- jquery validation -->
        <form id="ownerForm">
            <div class="card card-secondary  collapsed-card">
                <div class="card-header">
                    <h3 class="card-title">Director / Owner</h3>
                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                <!-- /.card-header -->
                <!-- form start -->

                <div class="card-body " style="display:none">

                    <table id="ownerTable" class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>IC or Passport</th>
                                <th>Email</th>
                                <th>Phone Number</th>
                                <th>Position</th>
                                <th>Ownership</th>
                                <th>Tax Refer</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var owner in cp.CompanyOwners)
                            {
                                <tr>
                                    <td>@owner.NamePerIC</td>
                                    <td>@owner.ICOrPassportNumber</td>
                                    <td>@owner.Email</td>
                                    <td>@owner.PhoneNumber</td>
                                    <td>@owner.Position</td>
                                    <td>@owner.OwnershipType</td>
                                    <td>@owner.TaxReferenceNumber</td>

                                    <td>
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-sm btn-warning btn-edit-owner mr-2" data-id="@owner.Id" data-name="@owner.NamePerIC" title="Edit">
                                                <i class="fa fa-edit"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-danger btn-delete-owner" data-id="@owner.Id" data-name="@owner.NamePerIC"><i class="fa fa-trash"></i></button>
                                        </div>
                                    </td>
                                </tr>
                            }

                        </tbody>
                    </table>

                    <div class="divider-line"></div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="ownerNamePerIc">Name Per IC*</label>
                                <input id="ownerNamePerIc" name="ownerNamePerIc" class="form-control " placeholder="JOHN DEE" />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="ownerIcOrPassword">IC Or Passport Number*</label>
                                <input id="ownerIcOrPassword" name="ownerIcOrPassword" class="form-control " placeholder="xxx-xxx-xxx-xxx" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="ownerEmail">Email</label>
                                <input type="email" id="ownerEmail" name="ownerEmail" class="form-control " placeholder="xxx@gmail.com" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="ownerPhone">Phone Number</label>
                                <input id="ownerPhone" name="ownerPhone" class="form-control " placeholder="+601xxxxxxxx" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="ownerPosition">Position</label>
                                <select asp-items="@ownerPosition" id="ownerPosition" name="ownerPosition" class="form-control select2">  </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="ownership">Ownership</label>
                                <select asp-items="@ownershipTypes" id="ownership" name="ownership" class="form-control select2">  </select>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="ownerTaxRefer">Tax Reference Number</label>
                                <input id="ownerTaxRefer" name="ownerTaxRefer" class="form-control " placeholder="xxxxxxxxx" />
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.card-body -->
                <div class="card-footer">
                    <button type="button" class="btn btn-danger float-end" id="btnCancelOwner" style="display:none">Cancel</button>
                    <button type="submit" class="btn btn-primary float-end mr-2" id="btnAddOwner">Add</button>
                </div>

                <!-- /.card -->
            </div>
        </form>
    </div>

    <div class="col-md-12">
        <form id="officialContactForm">
            <!-- jquery validation -->
            <div class="card card-secondary  collapsed-card">
                <div class="card-header">
                    <h3 class="card-title">Officials Contacts</h3>

                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                <!-- /.card-header -->
                <!-- form start -->

                <div class="card-body" style="display:none">
                    <table id="officialContactTable" class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>Address</th>
                                <th>Official Tel</th>
                                <th>Email</th>
                                <th>Remark</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var officalCt in cp.OfficialContacts)
                            {
                                <tr>
                                    <td>@officalCt.Address</td>
                                    <td>@officalCt.OfficeTel</td>
                                    <td>@officalCt.Email</td>
                                    <td>@officalCt.Remark</td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-sm btn-warning btn-edit-official-ct mr-2" data-id="@officalCt.Id" data-name="@officalCt.OfficeTel" title="Edit">
                                                <i class="fa fa-edit"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-danger btn-delete-official-ct" data-id="@officalCt.Id" data-name="@officalCt.OfficeTel"><i class="fa fa-trash"></i></button>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>

                    <div class="divider-line"></div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="officialAddress">Address</label>
                                <input id="officialAddress" name="officialAddress" class="form-control " placeholder="999,Jalan xx" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="officeTel">Office Tel</label>
                                <input id="officeTel" name="officeTel" class="form-control " placeholder="+605xxxxxxxx" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="officialEmail">Email</label>
                                <input type="email" id="officialEmail" name="officialEmail" class="form-control " placeholder="xxx@gmail.com" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="officialRemark">Remark</label>
                                <input id="officialRemark" name="officialRemark" class="form-control " placeholder="(Optional)" />
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.card-body -->
                <div class="card-footer">
                    <button type="button" class="btn btn-danger float-end" id="btnCancelOfficialContact" style="display:none">Cancel</button>
                    <button type="submit" class="btn btn-primary float-end mr-2" id="btnAddOfficialContact">Add</button>

                </div>
            </div>
            <!-- /.card -->
        </form>
    </div>


    <div class="col-md-12">
        <form id="staffContactForm">
            <!-- jquery validation -->
            <div class="card card-secondary  collapsed-card">
                <div class="card-header">
                    <h3 class="card-title">Staff / Communication Contacts</h3>

                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                <!-- /.card-header -->
                <!-- form start -->

                <div class="card-body" style="display:none">
                    <table id="staffContactTable" class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>Contact Name</th>
                                <th>Whatsapp</th>
                                <th>Email</th>
                                <th>Position</th>
                                <th>Remark</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var staffCt in cp.CommunicationContacts)
                            {
                                <tr>
                                    <td>@staffCt.ContactName</td>
                                    <td>@staffCt.WhatsApp</td>
                                    <td>@staffCt.Email</td>
                                    <td>@staffCt.Position</td>
                                    <td>@staffCt.Remark</td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-sm btn-warning btn-edit-staff-ct mr-2" data-id="@staffCt.Id" data-name="@staffCt.ContactName" title="Edit">
                                                <i class="fa fa-edit"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-danger btn-delete-staff-ct" data-id="@staffCt.Id" data-name="@staffCt.ContactName"><i class="fa fa-trash"></i></button>
                                        </div>
                                    </td>
                                </tr>
                            }

                        </tbody>
                    </table>

                    <div class="divider-line"></div>

                    <div class="row">

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="staffName">Contact Name</label>
                                <input id="staffName" name="staffName" class="form-control " placeholder="John Dee" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="staffWhatsapp">WhatsApp</label>
                                <input id="staffWhatsapp" name="staffWhatsapp" class="form-control " placeholder="+605xxxxxxxx" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="staffEmail">Email</label>
                                <input type="email" id="staffEmail" name="staffEmail" class="form-control " placeholder="xxx@gmail.com" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="staffPosition">Position</label>
                                <select asp-items="@staffPosition" id="staffPosition" name="staffPosition" class="form-control select2">  </select>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="staffRemark">Remark</label>
                                <input id="staffRemark" name="staffRemark" class="form-control " placeholder="(Optional)" />
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.card-body -->
                <div class="card-footer">
                    <button type="button" class="btn btn-danger float-end" id="btnCancelStaffContact" style="display:none">Cancel</button>
                    <button type="submit" class="btn btn-primary float-end mr-2" id="btnAddStaffContact">Add</button>

                </div>
            </div>
            <!-- /.card -->
        </form>
    </div>

    <div class="col-md-12">
        <!-- /.card-body -->
        <div class="float-end">
            <button id="btnSubmitRequest" class="btn btn-primary">Submit</button>
        </div>
    </div>
</div>





@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <!-- DataTables  & Plugins -->
    <script src="~/admin-lte/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/admin-lte/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/admin-lte/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="~/admin-lte/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="~/admin-lte/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/admin-lte/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/admin-lte/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/admin-lte/plugins/datatables-select/js/datatables.select.min.js"></script>
    <script src="~/admin-lte/plugins/datatables-select/js/select.bootstrap4.min.js"></script>


    <!-- Select2 -->
    <script src="~/admin-lte/plugins/select2/js/select2.full.min.js"></script>
    <script src="~/lib/flatpickr/flatpickr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/index.js"></script>
    <script src="~/js/companies/edit-company.js" asp-append-version="true"></script>
    <!-- date-range-picker -->
    }
