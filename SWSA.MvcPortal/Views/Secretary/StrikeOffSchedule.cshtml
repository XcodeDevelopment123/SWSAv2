@{
    ViewData["Title"] = "StrikeOffSchedule";
}

<h1>Strike Off Schedule</h1>

<div class="row">
    <div class="col-md-12">
        <!-- Alert Container -->
        <div id="alertContainer"></div>

        <!-- /.card -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-tasks me-2"></i>Strike Off Schedule
                </h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#taskModal" id="addNewBtn">
                        <i class="fas fa-plus me-2"></i>New Record
                    </button>
                    <button type="button" class="btn btn-info btn-sm ms-2" onclick="refreshData()">
                        <i class="fas fa-sync me-2"></i>Refresh
                    </button>
                </div>
            </div>
            <!-- /.card-header -->
            <div class="card-body" style="overflow:auto">
                <table id="taskDatatable" class="table table-bordered table-striped table-responsive">
                    <thead>
                        <tr>
                            <th rowspan="3">No</th>
                            <th rowspan="3">Ref</th>
                            <th rowspan="3">Company Name</th>
                            <th rowspan="3">Company No</th>
                            <th rowspan="3">Incorp Date</th>
                            <th rowspan="3">Year End</th>
                            <th colspan="13">Sec Dept</th>
                            <th colspan="2">Tax Dept</th>
                            <th rowspan="3">Job Completed/Backlog</th>
                            <th rowspan="3">Actions</th>
                        </tr>

                        <tr>
                            <th rowspan="2">Start Date</th>
                            <th rowspan="2">Completed Date</th>
                            <th colspan="2">Mgmt acc</th>
                            <th colspan="4">SSM Penalties</th>
                            <th rowspan="2">S/Off Doc send to client</th>
                            <th rowspan="2">SSM Submission Date</th>
                            <th rowspan="2">SSM Strike off date</th>
                            <th colspan="2">SSM Status</th>
                            <th rowspan="2">Date Pass to Tax Dept</th>
                            <th rowspan="2">Form C Submission date</th>
                        </tr>

                        <tr>
                            <th>Done by</th>
                            <th>Completed date</th>
                            <th>Penalties RM</th>
                            <th>Revised Penalties</th>
                            <th>Appeal date</th>
                            <th>Payment date</th>
                            <th>Remark</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be loaded dynamically -->
                    </tbody>
                </table>
            </div>
            <!-- /.card-body -->
        </div>
        <!-- /.card -->
    </div>
</div>

<!-- 模态框部分 -->
<div class="modal fade" id="taskModal" tabindex="-1" aria-labelledby="taskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="taskModalLabel">
                    <i class="fas fa-edit me-2"></i>
                    <span id="modalTitle">Add New Strike Off Record</span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <input type="hidden" id="recordId" value="">

                    <!-- Basic Information -->
                    <div class="form-info-label col-12">
                        <label>Basic Information</label>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="ref">Ref</label>
                                <input type="text" id="ref" name="ref" class="form-control" placeholder="Auto Fill" readonly />
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="clientSelect">Client <span class="text-danger">*</span></label>
                                <select id="clientSelect" name="clientSelect" class="form-control" required>
                                    <option value="">-- Select client --</option>
                                </select>
                                <small class="text-muted">Options are linked from the Sdn Bhd & LLP Client List.</small>
                                <input type="hidden" id="client" name="client" />
                                <input type="hidden" id="clientId" name="clientId" />
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="companyNo">Company No</label>
                                <input type="text" id="companyNo" name="companyNo" class="form-control" placeholder="Auto Fill" readonly />
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="incorpDate">Incorp Date</label>
                                <input type="text" id="incorpDate" name="incorpDate" class="form-control datepicker" placeholder="Auto Fill" readonly />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="yearEnd">Year End</label>
                                <input type="text" id="yearEnd" name="yearEnd" class="form-control datepicker" placeholder="Auto Fill" readonly />
                            </div>
                        </div>
                    </div>

                    <!-- Sec Dept -->
                    <div class="form-info-label col-12">
                        <label>Sec Dept</label>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="startDate">Start Date</label>
                                <input type="text" id="startDate" name="startDate" class="form-control datepicker" placeholder="Select date" />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="completeDate">Completed Date</label>
                                <input type="text" id="completeDate" name="completeDate" class="form-control datepicker" placeholder="Select date" />
                            </div>
                        </div>
                    </div>

                    <!-- Mgmt acc -->
                    <div class="form-info-label col-12">
                        <label>Management Account</label>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="doneBy">Done by</label>
                                <input type="text" id="doneBy" name="doneBy" class="form-control" placeholder="Enter name" />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="completedDate">Completed date</label>
                                <input type="text" id="completedDate" name="completedDate" class="form-control datepicker" placeholder="Select date" />
                            </div>
                        </div>
                    </div>

                    <!-- SSM Penalties -->
                    <div class="form-info-label col-12">
                        <label>SSM Penalties</label>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="penaltiesRM">Penalties RM</label>
                                <input type="number" id="penaltiesRM" name="penaltiesRM" class="form-control" placeholder="Enter amount" step="0.01" />
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="revisedPenalties">Revised Penalties</label>
                                <input type="number" id="revisedPenalties" name="revisedPenalties" class="form-control" placeholder="Enter amount" step="0.01" />
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="appealDate">Appeal date</label>
                                <input type="text" id="appealDate" name="appealDate" class="form-control datepicker" placeholder="Select date" />
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="paymentDate">Payment date</label>
                                <input type="text" id="paymentDate" name="paymentDate" class="form-control datepicker" placeholder="Select date" />
                            </div>
                        </div>
                    </div>

                    <!-- Additional Sec Dept Info -->
                    <div class="form-info-label col-12">
                        <label>Additional Sec Dept Information</label>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="s_OffDocsendtoClient">S/Off Doc send to client</label>
                                <input type="text" id="s_OffDocsendtoClient" name="s_OffDocsendtoClient" class="form-control datepicker" placeholder="Select date" />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="ssmSubmitDate">SSM Submission Date</label>
                                <input type="text" id="ssmSubmitDate" name="ssmSubmitDate" class="form-control datepicker" placeholder="Select date" />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="ssmStrikeoffDate">SSM Strike off date</label>
                                <input type="text" id="ssmStrikeoffDate" name="ssmStrikeoffDate" class="form-control datepicker" placeholder="Select date" />
                            </div>
                        </div>
                    </div>

                    <!-- SSM Status -->
                    <div class="form-info-label col-12">
                        <label>SSM Status</label>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="remark">Remark</label>
                                <input type="text" id="remark" name="remark" class="form-control" placeholder="Enter remark" />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="action">Action</label>
                                <input type="text" id="action" name="action" class="form-control" placeholder="Enter action" />
                            </div>
                        </div>
                    </div>

                    <!-- Tax Dept -->
                    <div class="form-info-label col-12">
                        <label>Tax Dept</label>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="datePassToTaxDept">Date Pass to Tax Dept</label>
                                <input type="text" id="datePassToTaxDept" name="datePassToTaxDept" class="form-control datepicker" placeholder="Select date" />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="formCSubmitDate">Form C Submission date</label>
                                <input type="text" id="formCSubmitDate" name="formCSubmitDate" class="form-control datepicker" placeholder="Select date" />
                            </div>
                        </div>
                    </div>

                    <!-- Completion Status -->
                    <div class="form-info-label col-12">
                        <label>Completion Status</label>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="jobCompleted">Job Completed/Backlog</label>
                                <select id="jobCompleted" name="jobCompleted" class="form-control">
                                    <option value="">Select Status</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Backlog">Backlog</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Pending">Pending</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
                <button type="button" class="btn btn-primary" id="saveBtn">
                    <i class="fas fa-save me-2"></i>Save
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">

    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

    <script>
        // ==========================================
        // 🔴 全局变量
        // ==========================================
        let dataTable;
        let clientList = []; 

        // ==========================================
        // 🟢 工具函数
        // ==========================================

        function getVal(obj, name) {
            if (!obj) return '';
            if (obj[name] !== undefined && obj[name] !== null) return obj[name];
            const camel = name.charAt(0).toLowerCase() + name.slice(1);
            if (obj[camel] !== undefined && obj[camel] !== null) return obj[camel];
            const targetLower = name.toLowerCase();
            for (const key in obj) {
                if (!Object.prototype.hasOwnProperty.call(obj, key)) continue;
                if (key.toLowerCase() === targetLower) return obj[key];
            }
            return '';
        }

        function formatIsoDate(isoString) {
            if (!isoString) return '';
            const date = new Date(isoString);
            if (isNaN(date.getTime())) return isoString;
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        function formatJsDate(date) {
            if (!date) return '';
            const dd = String(date.getDate()).padStart(2, '0');
            const mm = String(date.getMonth() + 1).padStart(2, '0');
            const yyyy = date.getFullYear();
            return `${dd}/${mm}/${yyyy}`;
        }

        function calculateYearEndDate(monthName) {
            if (!monthName) return '';
            const months = {
                "january": 0, "february": 1, "march": 2, "april": 3, "may": 4, "june": 5,
                "july": 6, "august": 7, "september": 8, "october": 9, "november": 10, "december": 11
            };
            const cleanName = monthName.trim().toLowerCase();
            const monthIndex = months[cleanName];
            if (monthIndex === undefined) return ''; 
            const currentYear = new Date().getFullYear();
            const date = new Date(currentYear, monthIndex + 1, 0); 
            return formatJsDate(date);
        }

        // ==========================================
        // 🟢 主逻辑
        // ==========================================

        $(document).ready(function() {
            
            // 1. 加载 Client List
            loadClientOptions();

            // 2. 初始化 DataTable
            initializeDataTable();

            // 3. 初始化 Datepicker
            $('.datepicker').datepicker({
                format: 'dd/mm/yyyy',
                autoclose: true,
                todayHighlight: true
            });

            // 4. 监听 Edit/Delete 点击事件 (🔥修复重点)
            $(document).on('click', '.edit-btn', function(e) {
                e.preventDefault();
                // 使用 closest 确保点到图标也能找到按钮
                const id = $(this).closest('button').data('id');
                console.log('Edit Clicked, ID:', id); 
                if (id) editRecord(id);
            });

            $(document).on('click', '.delete-btn', function(e) {
                e.preventDefault();
                const id = $(this).closest('button').data('id');
                console.log('Delete Clicked, ID:', id);
                if (id) deleteRecord(id);
            });

            // 5. 监听 Dropdown 选择 -> 自动填表
            $('#clientSelect').on('change', function() {
                const selectedId = $(this).val();
                
                $('#ref').val('');
                $('#companyNo').val('');
                $('#incorpDate').val('');
                $('#yearEnd').val('');
                $('#client').val('');   
                $('#clientId').val(''); 

                if (!selectedId) return;

                const client = clientList.find(c => String(getVal(c, 'Id')) === String(selectedId));

                if (client) {
                    $('#clientId').val(getVal(client, 'Id'));
                    $('#client').val(getVal(client, 'CompanyName')); 
                    $('#ref').val(getVal(client, 'FileNo')); 
                    $('#companyNo').val(getVal(client, 'CompanyNo') || getVal(client, 'RegistrationNumber'));
                    $('#incorpDate').val(formatIsoDate(getVal(client, 'IncorporationDate')));
                    $('#yearEnd').val(calculateYearEndDate(getVal(client, 'YearEndMonth')));
                    $('.datepicker').datepicker('update');
                }
            });

            // 6. 保存按钮
            $('#saveBtn').click(function() {
                saveS16Record();
            });

            // 7. 模态框重置
            $('#taskModal').on('hidden.bs.modal', function() {
                resetForm();
            });
        });

        // 🟢 DataTable 初始化
        function initializeDataTable() {
            dataTable = $('#taskDatatable').DataTable({
                "paging": true,
                "lengthChange": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
                "ajax": {
                    "url": "/secretary-dept/api/s16/get-all",
                    "type": "GET",
                    "dataSrc": function(response) {
                        return response.success ? response.data : [];
                    }
                },
                "columns": [
                    { 
                        "data": null, 
                        "render": function (data, type, row, meta) { return meta.row + 1; } 
                    },
                    { "data": "ref" },
                    { "data": "companyName" },
                    { "data": "companyNo" },
                    { 
                        "data": "incorpDate",
                        "render": function(data) { return formatIsoDate(data); }
                    },
                    { "data": "yearEnd" },
                    { "data": "startDate" },
                    { "data": "completeDate" },
                    { "data": "doneBy" },
                    { "data": "completedDate" },
                    { "data": "penaltiesRM", "render": $.fn.dataTable.render.number(',', '.', 2, 'RM ') },
                    { "data": "revisedPenalties", "render": $.fn.dataTable.render.number(',', '.', 2, 'RM ') },
                    { "data": "appealDate" },
                    { "data": "paymentDate" },
                    { "data": "s_OffDocsendtoClient" },
                    { "data": "ssMsubmitDate" },
                    { "data": "ssMstrikeoffDate" },
                    { "data": "remark" },
                    { "data": "action" },
                    { "data": "datePassToTaxDept" },
                    { "data": "formCSubmitDate" },
                    { 
                        "data": "jobCompleted",
                        "render": function (data) {
                            const cls = data === 'Completed' ? 'success' : (data === 'Backlog' ? 'danger' : 'warning');
                            return data ? `<span class="badge bg-${cls}">${data}</span>` : '';
                        }
                    },
                    {
                        "data": null, // 🔴 设为 null 以便访问整行数据
                        "orderable": false,
                        "render": function (data, type, row) {
                            // 🟢 兼容 ID 大小写
                            const id = row.id || row.Id; 
                            
                            if (!id) return '<span class="text-danger">Error: No ID</span>';

                            return `
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-warning edit-btn" data-id="${id}" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-danger delete-btn" data-id="${id}" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>`;
                        }
                    }
                ]
            });
        }

        // 🟢 加载 Client List
        function loadClientOptions() {
            $.ajax({
                url: '/api/auditdept/clients/get-list',
                type: 'GET',
                success: function(res) {
                    if (res && res.success) {
                        clientList = res.data || [];
                        const $sel = $('#clientSelect');
                        $sel.empty();
                        $sel.append('<option value="">-- Select client --</option>');

                        const filteredList = clientList.filter(c => {
                            const type = getVal(c, 'ClientType') || getVal(c, 'Type'); 
                            return type === 'SdnBhd' || type === 'LLP' || type === 1 || type === 2; 
                        });

                        filteredList.forEach(function(c) {
                            const id = getVal(c, 'Id');
                            const name = getVal(c, 'CompanyName');
                            const type = getVal(c, 'ClientType') || getVal(c, 'Type');
                            const displayText = `${name} (${type})`;
                            $sel.append(`<option value="${id}">${displayText}</option>`);
                        });
                    }
                }
            });
        }

        // 🟢 保存逻辑
        function saveS16Record() {
            if (!$('#clientSelect').val() && !$('#recordId').val()) {
                 showAlert('Please select a client.', 'warning');
                 return;
            }

            const rawId = $('#recordId').val();
            const idVal = rawId ? parseInt(rawId) : 0; 

            const formData = {
                id: idVal,
                ref: $('#ref').val(),
                companyName: $('#client').val(), 
                companyNo: $('#companyNo').val(),
                incorpDate: $('#incorpDate').val(),
                yearEnd: $('#yearEnd').val(),
                startDate: $('#startDate').val(),
                completeDate: $('#completeDate').val(),
                doneBy: $('#doneBy').val(),
                completedDate: $('#completedDate').val(),
                penaltiesRM: $('#penaltiesRM').val() ? parseFloat($('#penaltiesRM').val()) : null,
                revisedPenalties: $('#revisedPenalties').val() ? parseFloat($('#revisedPenalties').val()) : null,
                appealDate: $('#appealDate').val(),
                paymentDate: $('#paymentDate').val(),
                s_OffDocsendtoClient: $('#s_OffDocsendtoClient').val(),
                ssMsubmitDate: $('#ssmSubmitDate').val(),
                ssMstrikeoffDate: $('#ssmStrikeoffDate').val(),
                remark: $('#remark').val(),
                action: $('#action').val(),
                datePassToTaxDept: $('#datePassToTaxDept').val(),
                formCSubmitDate: $('#formCSubmitDate').val(),
                jobCompleted: $('#jobCompleted').val()
            };

            const url = idVal > 0 ? '/secretary-dept/api/s16/update' : '/secretary-dept/api/s16/create';
            const method = idVal > 0 ? 'PUT' : 'POST';

            $('#saveBtn').prop('disabled', true).html('<i class="fas fa-spinner fa-spin me-2"></i>Saving...');

            $.ajax({
                url: url,
                type: method,
                contentType: 'application/json',
                data: JSON.stringify(formData),
                success: function(res) {
                    if (res.success) {
                        $('#taskModal').modal('hide');
                        dataTable.ajax.reload();
                        showAlert('Saved successfully!', 'success');
                    } else {
                        let errorMsg = res.message || 'Unknown error';
                        if(res.errors && Array.isArray(res.errors)) {
                            errorMsg = res.errors.join('<br>');
                        }
                        showAlert('Error: ' + errorMsg, 'danger');
                    }
                },
                error: function(xhr) { showAlert('Error: ' + xhr.statusText, 'danger'); },
                complete: function() { $('#saveBtn').prop('disabled', false).html('<i class="fas fa-save me-2"></i>Save'); }
            });
        }

        // 🟢 编辑逻辑
        function editRecord(id) {
            $.get(`/secretary-dept/api/s16/get/${id}`, function(res) {
                if (res.success) {
                    const d = res.data;
                    $('#recordId').val(d.id || d.Id); // 兼容大小写
                    $('#ref').val(d.ref);
                    
                    const name = d.companyName;
                    $('#client').val(name); 
                    
                    const $option = $("#clientSelect option").filter(function() {
                        return $(this).text().includes(name); 
                    });
                    if ($option.length > 0) {
                        $option.prop('selected', true);
                    }

                    $('#companyNo').val(d.companyNo);
                    $('#incorpDate').val(formatIsoDate(d.incorpDate));
                    $('#yearEnd').val(d.yearEnd);
                    $('#startDate').val(formatIsoDate(d.startDate));
                    $('#completeDate').val(formatIsoDate(d.completeDate));
                    $('#doneBy').val(d.doneBy);
                    $('#completedDate').val(formatIsoDate(d.completedDate));
                    $('#penaltiesRM').val(d.penaltiesRM);
                    $('#revisedPenalties').val(d.revisedPenalties);
                    $('#appealDate').val(formatIsoDate(d.appealDate));
                    $('#paymentDate').val(formatIsoDate(d.paymentDate));
                    $('#s_OffDocsendtoClient').val(formatIsoDate(d.s_OffDocsendtoClient));
                    $('#ssmSubmitDate').val(formatIsoDate(d.ssMsubmitDate));
                    $('#ssmStrikeoffDate').val(formatIsoDate(d.ssMstrikeoffDate));
                    $('#remark').val(d.remark);
                    $('#action').val(d.action);
                    $('#datePassToTaxDept').val(formatIsoDate(d.datePassToTaxDept));
                    $('#formCSubmitDate').val(formatIsoDate(d.formCSubmitDate));
                    $('#jobCompleted').val(d.jobCompleted);

                    $('#modalTitle').text('Edit Strike Off Record');
                    $('#taskModal').modal('show');
                } else {
                    showAlert(res.message, 'danger');
                }
            });
        }

        // 🟢 删除逻辑
        function deleteRecord(id) {
            if (confirm('Delete this record?')) {
                $.ajax({
                    url: `/secretary-dept/api/s16/delete/${id}`,
                    type: 'DELETE',
                    success: function(res) {
                        if (res.success) {
                            dataTable.ajax.reload();
                            showAlert('Deleted successfully', 'success');
                        } else {
                            showAlert(res.message, 'danger');
                        }
                    }
                });
            }
        }

        function resetForm() {
            $('#taskForm')[0].reset();
            $('#recordId').val('');
            $('#client').val('');
            $('#clientId').val('');
            $('#modalTitle').text('Add New Strike Off Record');
            $('.datepicker').datepicker('update', '');
        }

        function showAlert(msg, type) {
            const html = `<div class="alert alert-${type} alert-dismissible fade show">${msg}<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>`;
            $('#alertContainer').html(html);
            setTimeout(() => $('.alert').alert('close'), 4000);
        }
        
        function refreshData() {
            dataTable.ajax.reload();
            showAlert('Data refreshed', 'info');
        }
    </script>
}