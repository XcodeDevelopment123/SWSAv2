@using Newtonsoft.Json
@using SWSA.MvcPortal.Commons.Constants
@using SWSA.MvcPortal.Commons.Enums
@using SWSA.MvcPortal.Commons.Extensions
@using SWSA.MvcPortal.Commons.Helpers
@using SWSA.MvcPortal.Models.CompnayWorks
@using SWSA.MvcPortal.Models.Users
@using SWSA.MvcPortal.Services.Interfaces
@model CompanyWorkAssignmentkEditPageVM
@inject IUserContext UserContext
@{
	ViewData["Title"] = "Edit";
	Layout = "~/Views/Shared/_Layout.cshtml";

	var workVM = Model.CompanyWork;

	var cp = workVM.Company;
	var cpDpt = workVM.CompanyDepartment;
	var progress = workVM.Progress;
	var userSelections = Model.UserSelections;

	var workTypes = SelectHelper.GetEnumSelectList<WorkType>(workVM.WorkType);
	var serviceScopes = SelectHelper.GetEnumSelectList<ServiceScope>(workVM.ServiceScope);
	var companyActivityLevels = SelectHelper.GetEnumSelectList<CompanyActivityLevel>(workVM.ActivitySize);
	var workProgressStatus = SelectHelper.GetEnumSelectList<WorkProgressStatus>(progress.Status);
	var isCompleted = SelectHelper.GetYesNoSelection(workVM.IsCompleted);

	var currentYear = DateTime.Now.Year;
	var startYear = currentYear - 10;
	var endYear = currentYear + 20;

	<input type="hidden" id="taskId" value="@workVM.TaskId" />
	<input type="hidden" id="progressId" value="@progress.ProgressId" />

}

<h3>Edit Task for @cp.Name (@cp.RegistrationNumber)</h3>
<div class="row">
	<div class="col-md-12">
		<form>
			<!-- jquery validation -->
			<div class="card card-primary">
				<div class="card-header">
					<a href="/companies/@cp.Id/overview">
						<h3 class="card-title">
							Company Info

						</h3>
					</a>
					<div class="card-tools">
						<button type="button" class="btn btn-tool" data-card-widget="collapse">
							<i class="fas fa-minus"></i>
						</button>
					</div>
				</div>

				<!-- /.card-header -->
				<!-- form start -->
				<div class="card-body row">
					<div class="col-md-6">
						<div class="form-group">
							<label for="companyName">Company</label>
							<input readonly value="@($"{cp.Name} ({cp.RegistrationNumber})")" class="form-control " placeholder="xxx sdn.bhd." />
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group">
							<label for="companyDepartment">Department</label>
							<input readonly value="@($"{cpDpt.Department.Name}")" class="form-control " placeholder="xxx sdn.bhd." />
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group">
							<label for="incorpDate">Incorporation Date</label>
							<div class="input-group">
								<input disabled type="text" value="@cp.IncorporationDate.ToFormattedString()" id="incorpDate" name="incorpDate" class="form-control" placeholder="Select date" />
								<div class="input-group-append">
									<span class="input-group-text">
										<i class="fa fa-calendar"></i>
									</span>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group">
							<label for="companyType">Company Type</label>
							<input readonly id="companyType" value="@cp.CompanyType.GetDisplayName()" class="form-control " />
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group">
							<label for="companyStatus">Company Status</label>
							<input readonly id="companyStatus" value="@cp.Status" class="form-control" />
						</div>
					</div>
				</div>

			</div>
		</form>
		<!-- /.card -->
	</div>

	<div class="col-md-12">
		<!-- jquery validation -->
		<form id="taskForm">
			<div class="card card-secondary">
				<div class="card-header">
					<h3 class="card-title">Task / Work</h3>
				</div>
				<!-- /.card-header -->
				<!-- form start -->

				<div class="card-body">

					<div class="row">
						<div class="col-md-6">
							<div class="form-group">
								<label for="workType">Work Type</label>
								<select id="workType" name="workType" class="form-control select2">
									@Html.RenderOptions(workTypes)
								</select>
							</div>
						</div>

						<div class="col-md-6">
							<div class="form-group">
								<label for="serviceScope">Services Offer</label>
								<select id="serviceScope" name="serviceScope" class="form-control select2">
									@Html.RenderOptions(serviceScopes)
								</select>
							</div>
						</div>

						<div class="col-md-6">
							<div class="form-group">
								<label for="companyActivityLevel">Company Activity Level</label>
								<select id="companyActivityLevel" name="companyActivityLevel" class="form-control select2">
									@Html.RenderOptions(companyActivityLevels)
								</select>
							</div>
						</div>

						<div class="col-md-6">
							<div class="form-group">
								<label for="dueDate">
									Due Date
									<i class="fas fa-info-circle" data-bs-toggle="tooltip" data-bs-placement="top" title="The deadline of the task, will apply the date month and year for the month to do and year to do"></i>
								</label>
								<div class="input-group">
									<input type="text" id="dueDate" name="dueDate" value="@workVM.DueDate.ToFormattedString()" class="form-control" placeholder="Select date" />
									<div class="input-group-append">
										<span class="input-group-text">
											<i class="fa fa-calendar"></i>
										</span>
									</div>
								</div>
							</div>
						</div>

						<!-- Handled By Staff -->
						<div class="col-md-6">
							<div class="form-group">
								<label for="handledByStaffId">Handled By</label>
								<select id="handledByStaffId" name="handledByStaffId" class="form-control select2 ">
									@if (userSelections.Count == 0)
									{
										<option disabled value="">No staff available in company</option>
									}
									else
									{
										<option disabled value="">Please select</option>
									}
									@foreach (var user in userSelections)
									{
										<option value="@user.StaffId" selected>
											@user.FullName
											@if (user.StaffId == UserContext.StaffId)
											{
												<span>(You)</span>
											}
										</option>
									})

								</select>
							</div>
						</div>
						<div class="col-md-6">
							<div class="form-group">
								<label for="internalNote">Internal Note</label>
								<input type="text" id="internalNote" value="@workVM.InternalNote" name="internalNote" class="form-control" placeholder="(Optional)" />
							</div>
						</div>

						<div class="col-md-6">
							<div class="form-group">
								<label for="isCompleted">Is Complete</label>
								<select id="isCompleted" name="isCompleted" class="form-control select2">
									@Html.RenderOptions(isCompleted);
								</select>
							</div>
						</div>

						<div class="col-md-6">
							<div class="form-group">
								<label for="completedDate">Completed At</label>
								<div class="input-group">
									<input @(workVM.IsCompleted ? "" : "disabled") type="text" id="completedDate" value="@workVM.CompletedDate.ToFormattedString()" name="completedDate" class="form-control" placeholder="Select date" />
									<div class="input-group-append">
										<span class="input-group-text">
											<i class="fa fa-calendar"></i>
										</span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- /.card-body -->
				<div class="card-footer ">
					<button id="btnSubmitRequest" class="btn btn-primary float-end">Save</button>
				</div>

				<!-- /.card -->
			</div>
		</form>
	</div>

	<div class="col-md-12">
		<!-- jquery validation -->
		<form id="progressForm">
			<div class="card card-secondary">
				<div class="card-header">
					<h3 class="card-title">Progress</h3>
				</div>
				<!-- /.card-header -->
				<!-- form start -->

				<div class="card-body">

					<div class="row">

						<div class="col-md-5">
							<div class="form-group">
								<label for="startDate">Task Start At</label>
								<div class="input-group">
									<input type="text" id="startDate" value="@progress.StartDate.ToFormattedString()" name="startDate" class="form-control" placeholder="Select date" />
									<div class="input-group-append">
										<span class="input-group-text">
											<i class="fa fa-calendar"></i>
										</span>
									</div>
								</div>
							</div>
						</div>

						<div class="col-md-5">
							<div class="form-group">
								<label for="endDate">Task End At</label>
								<div class="input-group">
									<input type="text" id="endDate" value="@progress.EndDate.ToFormattedString()" name="endDate" class="form-control" placeholder="Select date" />
									<div class="input-group-append">
										<span class="input-group-text">
											<i class="fa fa-calendar"></i>
										</span>
									</div>
								</div>
							</div>
						</div>

						<div class="col-md-2">
							<div class="form-group">
								<label for="timeTakenInDays">
									Used Day
									<i class="fas fa-info-circle" data-bs-toggle="tooltip" data-bs-placement="top" title="The total number of days includes the start date."></i>
								</label>
								<input type="text" readonly id="timeTakenInDays" value="@progress.TimeTakenInDays" name="timeTakenInDays" class="form-control" placeholder="(Auto calc)" />

							</div>
						</div>

						<div class="col-md-6">
							<div class="form-group">
								<label for="serviceScope">Services Offer</label>
								<select asp-items="workProgressStatus" id="status" name="status" class="form-control select2">
								</select>
							</div>
						</div>

						<div class="col-md-6">
							<div class="form-group">
								<label for="progressNote">Progress Note</label>
								<input type="text" id="progressNote" value="@progress.ProgressNote" name="progressNote" class="form-control" placeholder="(Optional)" />
							</div>
						</div>
					</div>
				</div>
				<!-- /.card-body -->
				<div class="card-footer ">
					<button id="btnSubmitRequest" class="btn btn-primary float-end">Save</button>
				</div>

				<!-- /.card -->
			</div>
		</form>
	</div>

</div>



@section Scripts {
	<partial name="_ValidationScriptsPartial" />
	<partial name="_DatatablesScriptsPartial" />

	<script src="~/js/companies/edit-work.js" asp-append-version="true"></script>
	<!-- date-range-picker -->
    }
