

using AutoMapper;
using Microsoft.Extensions.Caching.Memory;
using SWSA.MvcPortal.Commons.Guards;
using SWSA.MvcPortal.Commons.Services.Messaging;
using SWSA.MvcPortal.Entities;
using SWSA.MvcPortal.Repositories.Interfaces;
using SWSA.MvcPortal.Services.Interfaces;

namespace SWSA.MvcPortal.Services;
// <auto-generated />
public class SystemNotificationLogService(
IMemoryCache cache,
MemoryCacheEntryOptions cacheOptions,
IMapper mapper,
IUserContext userContext,
ISystemNotificationLogRepository repo
    ) : ISystemNotificationLogService
{
    public async Task<List<SystemNotificationLog>> GetLogs()
    {
        var data = await repo.GetAllAsync();
        return data.ToList();
    }

    public async Task AddLog(MessagingResult result)
    {
        Guard.AgainstCompanyStaff(userContext);

        var log = new SystemNotificationLog
        {
            Channel = result.MessageEnvelope.Channel,
            Recipient = result.MessageEnvelope.Recipient,
            TemplateCode = result.MessageEnvelope.TemplateCode,
            IsSuccess = result.IsSuccess,
            ResultMessage = result.Message,
            Reason = result.MessageEnvelope.Reason,
        };

        repo.Add(log);
        await repo.SaveChangesAsync();
    }

}
