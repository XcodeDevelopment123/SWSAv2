
// <auto-generated />

using AutoMapper;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Caching.Memory;
using SWSA.MvcPortal.Commons.Constants;
using SWSA.MvcPortal.Entities;
using SWSA.MvcPortal.Entities.Clients;
using SWSA.MvcPortal.Persistence;
using SWSA.MvcPortal.Repositories.Interfaces;
using SWSA.MvcPortal.Repositories.Repo;
using SWSA.MvcPortal.Services.Interfaces;

namespace SWSA.MvcPortal.Services;

public class MsicCodeService(
IMemoryCache cache,
MemoryCacheEntryOptions cacheOptions,
AppDbContext db
    ) : IMsicCodeService
{
    private readonly DbSet<MsicCode> msicCodes = db.Set<MsicCode>();

    public async Task<List<MsicCode>> GetMsicCodeAsync()
    {
        return await GetMsicCodesFromCacheAsync();
    }

    private async Task<List<MsicCode>> GetMsicCodesFromCacheAsync()
    {
        if (cache.TryGetValue(DataCacheKey.MsicCode, out List<MsicCode>? codes))
        {
            return codes ?? [];
        }

        // Fetch data from the database or any other source
        codes = [.. await msicCodes.ToListAsync()];
        cache.Set(DataCacheKey.MsicCode, codes, cacheOptions);
        return codes;
    }

}
