// <auto-generated />

using Microsoft.EntityFrameworkCore;
using SWSA.MvcPortal.Entities;
using SWSA.MvcPortal.Persistence;
using SWSA.MvcPortal.Repositories.Interfaces;
using System.ComponentModel.Design;

namespace SWSA.MvcPortal.Repositories.Repo;

public class DocumentRecordRepository(AppDbContext db) : RepositoryBase<DocumentRecord>(db), IDocumentRecordRepository
{

    // Implement the method
    public async Task<List<DocumentRecord>> GetDocumentRecordsByCompanyIds(List<int> companyIds)
    {
        var query = await BuildQueryAsync();
        if (companyIds.Count == 1)
        {
            var companyId = companyIds.First();
            ///TODO: Use department string to query
            return await query.ToListAsync();
        }
        return await query.ToListAsync();
    }

    public async Task<List<DocumentRecord>> GetDocumentRecordsByCompanyId(int companyId)
    {
        var query = await BuildQueryAsync();
        ///TODO: Use department string to query
        return await query
            .ToListAsync();
    }

    public async Task<List<DocumentRecord>> GetDocumentRecordsByCompanyDepartmentId(int companyDepartmentId)
    {
        var query = await BuildQueryAsync();
        ///TODO: Use department string to query
        return await query
           .ToListAsync();
    }

    public async Task<List<DocumentRecord>> GetDocumentRecordsByStaffId(string staffId)
    {
        var query = await BuildQueryAsync();
        return await query
           .Where(c => c.HandledByStaff != null && c.HandledByStaff.StaffId == staffId)
           .ToListAsync();
    }

    //Rewrite the GetAllAsync method
    protected override Task<IQueryable<DocumentRecord>> BuildQueryAsync()
    {
        var query = db.DocumentRecords
                .Include(c => c.HandledByStaff) 
                .Include(c => c.WorkAssignment).ThenInclude(c=>c.Company) 
                .AsNoTracking();
        return Task.FromResult(query);
    }

    //Rewrite the GetWithIncludesAsync method
    protected override Task<IQueryable<DocumentRecord>> BuildQueryWithIncludesAsync()
    {
        var query = db.DocumentRecords
                .Include(c => c.HandledByStaff)
                .Include(c => c.WorkAssignment).ThenInclude(c => c.Company)
                .AsNoTracking();
        return Task.FromResult(query);
    }

    //Add the method that want to perform before delete the entity
    protected override async Task BeforeRemove(DocumentRecord entity)
    {
        //Do you logic here
    }

    //Add the method that want to perform before add the entity
    protected override async Task BeforeAdd(DocumentRecord entity)
    {
        //Do you logic here
    }

    //Add the method that want to perform before update the entity
    protected override async Task BeforeUpdate(DocumentRecord entity)
    {
        //Do you logic here
    }
}
