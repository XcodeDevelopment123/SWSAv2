using Microsoft.EntityFrameworkCore;
using SWSA.MvcPortal.Entities;
using SWSA.MvcPortal.Persistence;
using SWSA.MvcPortal.Repositories.Interfaces;

namespace SWSA.MvcPortal.Repositories.Repo;
// <auto-generated />
public class WorkAssignmentUserMappingRepository(AppDbContext db) : RepositoryBase<WorkAssignmentUserMapping>(db), IWorkAssignmentUserMappingRepository
{
    private IQueryable<WorkAssignmentUserMapping> BaseQuery(bool asNoTracking = false)
    {
        var query = db.Set<WorkAssignmentUserMapping>();
        return asNoTracking ? query.AsNoTracking() : query;
    }
    // Implement the method
    public async Task<WorkAssignmentUserMapping?> GetByUserIdAsync(int taskId, int userId)
    {
        var query = db.Set<WorkAssignmentUserMapping>().FirstOrDefaultAsync(c =>
        c.WorkAssignmentId == taskId &&
        c.UserId == userId);
        return await query;
    }

    public Task<List<WorkAssignmentUserMapping>> GetTodayRemindUserAssignmentsAsync()
    {
        var today = DateTime.Today;
        var query = BaseQuery()
             .Where(x => x.WorkAssignment.ReminderDate.HasValue
                         && x.WorkAssignment.ReminderDate.Value.Date == today
                         && x.WorkAssignment.Progress!.Status != Commons.Enums.WorkProgressStatus.Completed)
             .Include(x => x.User)
             .Include(x => x.WorkAssignment.Company)
             .Include(x => x.WorkAssignment.Progress);
        return query.ToListAsync();
    }

    //Rewrite the GetAllAsync method
    protected override Task<IQueryable<WorkAssignmentUserMapping>> BuildQueryAsync()
    {
        //Default query no action
        return Task.FromResult(db.Set<WorkAssignmentUserMapping>().AsQueryable());

        // Do you query here
        // var query = db.TableNames.AsNoTracking();
        // return Task.FromResult(query);    
    }

    //Rewrite the GetWithIncludesAsync method
    protected override Task<IQueryable<WorkAssignmentUserMapping>> BuildQueryWithIncludesAsync()
    {
        //Default query no action
        return Task.FromResult(db.Set<WorkAssignmentUserMapping>().AsQueryable());

        // Do you query here
        // var query = db.TableNames.AsNoTracking();
        // return Task.FromResult(query);    
    }

    //Rewrite the GetSingleAsync method
    protected override Task<IQueryable<WorkAssignmentUserMapping>> BuildGetByIdQueryAsync()
    {
        //Default query no action
        return Task.FromResult(db.Set<WorkAssignmentUserMapping>().AsQueryable());

        // Do you query here
        // var query = db.TableNames;
        // return Task.FromResult(query);    
    }

    //Add the method that want to perform before delete the entity
    protected override async Task BeforeRemove(WorkAssignmentUserMapping entity)
    {
        //Do you logic here
    }

    //Add the method that want to perform before add the entity
    protected override async Task BeforeAdd(WorkAssignmentUserMapping entity)
    {
        //Do you logic here
    }

    //Add the method that want to perform before update the entity
    protected override async Task BeforeUpdate(WorkAssignmentUserMapping entity)
    {
        //Do you logic here
    }
}
